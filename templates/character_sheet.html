<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Character Sheet</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ –±–∞–∑—É</button>
    <button onclick="downloadFile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑ –±–∞–∑—ã</button>
    <h1>{{ data["Name"] }} - Level {{ data["Level"] }} {{ data["Class"] }}</h1>
    <h1>{{ data["Spells"]["slots"][0]["used"]}}</h1>
    <h1>{{ data["Spells"]["slots"][1]["used"]}}</h1>

    <div id="common" class="content" style="display: none;">üè† –û–±—â–µ–µ</div>
    <div id="stats" class="content" style="display: none;">üîç –ß–∏—Å–ª–∞</div>
    <div id="feats" class="content" style="display: none;">ü¶∂ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</div>
    <div id="items" class="content" style="display: none;">üëú –ü—Ä–µ–¥–º–µ—Ç—ã</div>
    <div id="spells" class="content">
        {% for i in range(data.Spells.slots|length) %}
            <div class="panel">
                {{ i }}-–π –∫—Ä—É–≥    
                <div class="checkbox-group">
                    {% for i in range(data.Spells.slots[i]["available"]) %}
                        <input type="checkbox">
                    {% endfor %}     
                </div>
            </div>
            <div class="panel-content">
                

                <div class="collapsible">üîπ –≠–ª–µ–º–µ–Ω—Ç 1</div>
                <div class="collapsible-content">–≠—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç–ª–µ–º–µ–Ω—Ç–∞ 1.</div>

                <div class="collapsible">üîπ –≠–ª–µ–º–µ–Ω—Ç 2</div>
                <div class="collapsible-content">–≠—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç–ª–µ–º–µ–Ω—Ç–∞ 2.</div>

                <div class="collapsible">–°–æ–Ω —Å–∏–Ω–µ–π –≤—É–∞–ª–∏</div>
                <div class="collapsible-content">
                    <b>–®–∫–æ–ª–∞: </b><span>–í—ã–∑–æ–≤</span><br>
                    <b>–í—Ä–µ–º—è –≤—ã–∑–æ–≤–∞: </b><span>10 –º–∏–Ω—É—Ç</span><br>
                    <b>–î–∏—Å—Ç–∞–Ω—Ü–∏—è: </b><span>10 –º–µ—Ç—Ä–æ–≤</span><br>
                    <span>–í—ã –∏ –¥–æ –≤–æ—Å—å–º–∏ —Å–æ–≥–ª–∞—Å–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ —Ç–µ—Ä—è–µ—Ç–µ —Å–æ–∑–Ω–∞–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è –∏ –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ –≤–∏–¥–µ–Ω–∏—è –¥—Ä—É–≥–æ–≥–æ –º–∏—Ä–∞ –Ω–∞ –ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–º –ø–ª–∞–Ω–µ, –∫–∞–∫ –Ω–∞–ø—Ä–∏–º–µ—Ä –û—Ä—Ç–∞, –¢–æ—Ä–∏–ª–∞, –ö—Ä–∏–Ω–Ω–∞ –∏–ª–∏ –≠–±–µ—Ä—Ä–æ–Ω–∞. –ï—Å–ª–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ç–æ –≤–∏–¥–µ–Ω–∏—è –ø—Ä–∏–≤–æ–¥—è—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –∫–∞–∂–¥—ã–π –∏–∑ –≤–∞—Å –Ω–∞—Ö–æ–¥–∏—Ç –∏ –æ—Ç–æ–¥–≤–∏–≥–∞–µ—Ç –∑–∞–≥–∞–¥–æ—á–Ω—ã–π —Å–∏–Ω–∏–π –∑–∞–Ω–∞–≤–µ—Å. –ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Ç–µ–º, —á—Ç–æ –≤—ã –º–µ–Ω—Ç–∞–ª—å–Ω–æ –∏ <b>—Ñ–∏–∑–∏—á–µ—Å–∫–∏</b> –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç–µ—Å—å –≤ –º–∏—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –≤ –≤–∏–¥–µ–Ω–∏—è—Ö.\n\n–ß—Ç–æ–±—ã –Ω–∞–ª–æ–∂–∏—Ç—å —ç—Ç–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ, —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤ –º–∏—Ä–µ, –≤ –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ø–∞—Å—Ç—å, –∏ –≤—ã –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å –æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ —ç—Ç–æ–≥–æ –º–∏—Ä–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è. –í—ã –ø–æ–ø–∞–¥–∞–µ—Ç–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 1 –º–∏–ª–∏ –æ—Ç —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–∞–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç –±—ã–ª —Å–æ–∑–¥–∞–Ω. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ª–æ–∂–∏—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –±–µ–∑ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞, –µ—Å–ª–∏ –æ–¥–Ω–æ –∏–∑ —Å—É—â–µ—Å—Ç–≤ –ø–æ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º —ç—Ç–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è —Ä–æ–¥–∏–ª–æ—Å—å –≤ —Ç–æ–º –º–∏—Ä–µ.</span>

                </div>
            </div>
        {% endfor %}    
    </div>
    <div id="bio" class="content" style="display: none;">üë§ –ë–∏–æ</div>

    <div class="tab-bar">
        <div class="tab active" data-tab="common" onclick="showTab('common')">
            üè†
        </div>
        <div class="tab" data-tab="stats" onclick="showTab('stats')">
            üîç
        </div>
        <div class="tab" data-tab="feats" onclick="showTab('feats')">
            ü¶∂
        </div>
        <div class="tab" data-tab="items" onclick="showTab('items')">
            üëú
        </div>
        <div class="tab" data-tab="spells" onclick="showTab('spells')">
            üìï
        </div>
        <div class="tab" data-tab="bio" onclick="showTab('bio')">
            üë§
        </div>
    </div>

    <script>

        function updateCheckbox(level, index, checked) {
            console.log(`level ${level} index ${index} checked ${checked}`)
            fetch('/update_checkbox', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    level: level,
                    index: index,
                    checked: checked
                }),
            }).then(response => response.json()).then(data => {
                if (data.status !== 'success') {
                    console.error('Failed to update checkbox state');
                }
            });
        }

        function downloadFile() {
            fetch('/download_json')
                .then(response => response.json())
                .then(data => {
                    let jsonString = JSON.stringify(data, null, 4); // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º JSON –∫—Ä–∞—Å–∏–≤–æ
                    let blob = new Blob([jsonString], { type: 'application/json' });
                    let a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = 'character_data.json';
                    a.click();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.');
                });
        }

        function uploadFile() {
            let fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!');
                return;
            }

            let file = fileInput.files[0];
            let reader = new FileReader();

            reader.onload = function(event) {
                try {
                    let jsonData = JSON.parse(event.target.result);

                    fetch('/upload_json', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(jsonData),
                    }).then(response => response.json()).then(data => {
                        if (data.status === 'success') {
                            alert('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –±–∞–∑—É!');
                        } else {
                            alert('–û—à–∏–±–∫–∞: ' + data.error);
                        }
                    }).catch(error => {
                        console.error('–û—à–∏–±–∫–∞:', error);
                        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.');
                    });

                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON.');
                }
            };

            reader.readAsText(file);
        }



        const collapsibles = document.querySelectorAll('.collapsible');
        collapsibles.forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                content.style.display = content.style.display === 'block' ? 'none' : 'block';
            });
        });
    </script>

    <script>
        function showTab(tabName) {
            document.querySelectorAll(".content").forEach(c => c.style.display = "none");
            document.getElementById(tabName).style.display = "flex";

            document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
            document.querySelector(`[data-tab='${tabName}']`).classList.add("active");
        }

        function toggleCollapsible(element) {
            let content = element.nextElementSibling;
            content.style.display = content.style.display === "block" ? "none" : "block";
        }

        function togglePanel(event) {
            // –ò—Å–∫–ª—é—á–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —á–µ–∫–±–æ–∫—Å—ã
            if (event.target.type === "checkbox") return;
            
            let content = event.currentTarget.nextElementSibling;
            content.style.display = content.style.display === "block" ? "none" : "block";
        }

        function updateCheckboxes(event) {
            event.stopPropagation(); // 
            
            let checkboxes = Array.from(event.currentTarget.parentElement.querySelectorAll("input"));

            if (event.target.checked) {
                event.target.checked = false;


                for (let i = 0; i < checkboxes.length; i++) {
                    console.log(i)
                    if (!checkboxes[i].checked) {
                        console.log(checkboxes[i].checked)
                        checkboxes[i].checked = true;
                        break;
                    }
                }

            } else { 
                event.target.checked = true;


                for (let i = checkboxes.length - 1; i >= 0; i--) {
                    if (checkboxes[i].checked) {
                        checkboxes[i].checked = false;
                        break;
                    }
                }

            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            showTab("spells");

            document.querySelectorAll(".collapsible").forEach(item => {
                item.addEventListener("click", function() {
                    toggleCollapsible(this);
                });
            });

            document.querySelectorAll(".panel").forEach(item => {
                item.addEventListener("click", togglePanel);
            });

            document.querySelectorAll(".checkbox-group input").forEach(checkbox => {
                checkbox.addEventListener("click", updateCheckboxes);
            });
        });
    </script>

</body>
</html>
